<!DOCTYPE html>
<html>
  <body>
    <h1>Socket Test</h1>
    <button onclick="restart()">RESTART (host)</button>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      const room = "room1";
      const name = "User" + Math.floor(Math.random() * 1000);

      socket.on("connect", () => console.log("connected", socket.id));
      socket.on("LOBBY", (d) => console.log("LOBBY", d));
      socket.on("GAME_STARTED", (d) => console.log("GAME_STARTED", d));
      socket.on("GAME_RESTARTED", (d) => console.log("GAME_RESTARTED", d));
      socket.on("ERROR", (d) => console.log("ERROR", d)); // IMPORTANT
      socket.on("STATE", (data) => {
        console.log("STATE", data);
      });
      socket.on("STATE", (data) => {
        console.log("STATE", data);

        const out = document.getElementById("out");
        if (!data.players || data.players.length === 0) {
          out.textContent = "No players in STATE";
          return;
        }

        // show YOUR board by matching socket.id (best)
        const me =
          data.players.find((p) => p.id === socket.id) || data.players[0];

        if (!me.board) {
          out.textContent =
            "Board is null (start() didn't create it or not sent).";
          return;
        }

        out.textContent = me.board.map((row) => row.join(" ")).join("\n");
      });

      function join() {
        console.log("EMIT JOIN", room, name);
        socket.emit("JOIN", { room, name });
      }

      function start() {
        console.log("EMIT START", room);
        socket.emit("START", { room });
      }

      function restart() {
        console.log("EMIT RESTART", room);
        socket.emit("RESTART", { room });
      }
    </script>

    <button onclick="join()">Join Room</button>
    <button onclick="start()">Start Game</button>
    <pre id="out"></pre>
  </body>
</html>
